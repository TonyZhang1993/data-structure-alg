## çŸ¥è¯†å›é¡¾

> æµ…æ‹·è´åªå¤åˆ¶åœ°å€å€¼,å®é™…ä¸Šè¿˜æ˜¯æŒ‡å‘åŒä¸€å †å†…å­˜ä¸­çš„æ•°æ®
<br>æ·±æ‹·è´åˆ™æ˜¯é‡æ–°åˆ›å»ºäº†ä¸€ä¸ªç›¸åŒçš„æ•°æ®,ä¿®æ”¹å±æ€§ä¸å½±å“åŸæ¥çš„å€¼

æ•°ç»„/å¯¹è±¡æµ…æ‹·è´ã€å¦‚æœé‡Œé¢çš„å…ƒç´ æ˜¯åŸºæœ¬ç±»å‹çš„è¯,å±äºæ·±æ‹·è´ã€‘

```js
arr.slice()
arr.concat()
arr.forEach(...)
Object.assign(arr1, arr)  //  ä¹Ÿå¯ç”¨äºå¯¹è±¡
const a2 = [...a1]  //  ç­‰åŒäº arr.slice()

const calendarEvent = {
  title: "Builder.io Conf",
  date: new Date(123),
  attendees: ["Steve"]
}

const shallowCopy = {...calendarEvent}

// åŒæ ·åœ¨åŸå¯¹è±¡é‡Œæ·»åŠ äº†
shallowCopy.attendees.push("Bob")

// åŒæ ·åœ¨åŸå¯¹è±¡é‡Œæ·»åŠ äº†
shallowCopy.date.setTime(456)
```

å¸¸è§çš„æ·±æ‹·è´æ–¹å¼æœ‰:

- _.cloneDeep(): lodash åº“æ–¹æ³•
```js
const obj2 = _.cloneDeep(obj1);

ç¼ºç‚¹:  éœ€è¦å•ç‹¬å¼•å…¥ lodash åŒ…, å¢åŠ æ‰“åŒ…ä½“ç§¯; è™½ç„¶å¯ä»¥å•ç‹¬å¼•å…¥è¯¥åŒ…çš„æŸä¸ªæ–¹æ³•
import cloneDeep from 'lodash/cloneDeep'
å¥½äº
import { cloneDeep } from 'lodash'
```

- jQuery.extend()
å°†ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡çš„å†…å®¹åˆå¹¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­
```js
const $ = require('jquery');
const obj1 = {
    a: 1,
    b: { f: { g: 1 } },
    c: [1, 2, 3]
};
const obj2 = $.extend(true, {}, obj1);  //  å‚æ•°true è¡¨ç¤ºæ˜¯å¦æ·±æ‹·è´
console.log(obj1.b.f === obj2.b.f); // false
```

- JSON.stringify()
```js
const obj2=JSON.parse(JSON.stringify(obj1));
//  ä½†æ˜¯è¿™ç§æ–¹å¼å­˜åœ¨å¼Šç«¯,ä¼šå¿½ç•¥undefined symbol map regexå’Œå‡½æ•°

ä¾‹å­
const kitchenSink = {
  set: new Set([1, 3, 3]),
  map: new Map([[1, 2]]),
  regex: /foo/,
  deep: { array: [ new File(someBlobData, 'file.txt') ] },
  error: new Error('Hello!')
}

const veryProblematicCopy = JSON.parse(JSON.stringify(kitchenSink))

// {
//   "set": {},
//   "map": {},
//   "regex": {},
//   "deep": {
//     "array": [
//       {}
//     ]
//   },
//   "error": {},
// }
```

å¦‚ä½•å®ç°ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„çš„æµ…æ‹·è´
```js
var shallowCopy = function (target) {
  if (typeof target !== 'object') return 
  const result = Array.isArray(target) ? [] : {}
  //  éå†targetå±æ€§,in æ–¹æ³•ä¼šéå†,ä¸ä»…éå†å¯¹è±¡è‡ªèº«å±æ€§,è¿˜ä¼šéå†ç»§æ‰¿çš„inumerable å±æ€§
  for (ele in target) {
    //  åˆ¤æ–­æ˜¯targetè‡ªèº«çš„å±æ€§æ‰æ‹·è´
    if (target.hasOwnProperty(ele)) {
      result[ele] = target[ele]
    }
  }

  return result
}
```

æ‰‹å†™å¾ªç¯é€’å½’ æ·±æ‹·è´
```js
var deepCopy = function (target) {
  if (typeof target !== 'object') return 
  const result = Array.isArray(target) ? [] : {}
  //  éå†targetå±æ€§,in æ–¹æ³•ä¼šéå†,ä¸ä»…éå†å¯¹è±¡è‡ªèº«å±æ€§,è¿˜ä¼šéå†ç»§æ‰¿çš„inumerable å±æ€§
  for (ele in target) {
    //  åˆ¤æ–­æ˜¯targetè‡ªèº«çš„å±æ€§æ‰æ‹·è´
    if (target.hasOwnProperty(ele)) {
      result[ele] = typeof target[ele] === 'object' ? deepCopy(target[ele]) : target[ele]
    }
  }

  return result
}
//  é—®é¢˜:å€¼ä¸ºnullä¼šèµ‹å€¼ä¸€ä¸ªç©ºå¯¹è±¡
```

```js
//  å¯¹è±¡å¾ªç¯å¼•ç”¨çš„ä¾‹å­
const obj1 = {};
const obj2 = {};

obj1.ref = obj2;
obj2.ref = obj1;

console.log(obj1); // è¾“å‡º: { ref: { ref: [Circular] } }
console.log(obj2); // è¾“å‡º: { ref: { ref: [Circular] } }
```

æ¯”è¾ƒå®Œç¾çš„æ·±æ‹·è´ä¾‹å­
```js
function isRegExp(obj) {
  return Object.prototype.toString.call(obj) === '[object RegExp]'
}
function isDate(obj) {
  return Object.prototype.toString.call(obj) === '[object Date]'
}
function isSet(obj) {
  return Object.prototype.toString.call(obj) === '[object Set]'
}
function isObject(obj) {
  return typeof obj === 'object'
  // return Object.prototype.toString.call(obj) === '[object Object]'
}
function isArray(obj) {
  return Object.prototype.toString.call(obj) === '[object Array]' 
  //  return Array.isArray(obj)
}
//  æ¶µç›–æ‰€æœ‰ç±»å‹çš„å¤åˆ¶
function deepCopy(obj, map = new WeakMap()) {
  //  åˆ¤æ–­æ˜¯å¦ä¸ºregExp / Date / Set
  if (isRegExp(obj) || isDate(obj) || isSet(obj)) {
    return new obj.constructor(obj) //  ç±»ä¼¼äºnew Date()  ï¼ï¼ï¼è®°ä½åŠ ä¸Šå‚æ•°
  }
  //  åˆ¤æ–­æ˜¯å¦ä¸ºnull
  if (obj === null) return obj
  //  åŸºæœ¬ç±»å‹å€¼ & function
  if (typeof obj !== 'object') return obj
  //  èµ‹å€¼å¾ªç¯å¼•ç”¨çš„ç»“æœ
  if (map.has(obj)) {
    return map.get(obj)
  }

  const cloneObj = Array.isArray(obj) ? [] : {}
  //  let cloneObj = new obj.constructor(); ä¸ä¸Šä¸€å¥è¯ç­‰ä»·
  // ç¼“å­˜å¾ªç¯å¼•ç”¨çš„æ‹·è´ç»“æœï¼ï¼ï¼ï¼ï¼ï¼
  map.set(obj, cloneObj)
  //  ä¼šæŠŠåŸå‹é“¾ä¸Šçš„å±æ€§éƒ½éå†ï¼ï¼ï¼ï¼ï¼
  for (let prop in obj) {
    //  è¿‡æ»¤,ä»…å¤åˆ¶è‡ªèº«å±æ€§ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
    if (obj.hasOwnProperty(prop)) {
      cloneObj[prop] = deepCopy(obj[prop])
    }
  }

  return cloneObj

}
```
è¡¥å……çŸ¥è¯†ç‚¹è§: [å­—å…¸é›†åˆ](../dataStructure/å­—å…¸å’Œé›†åˆ.md)

`for ... in`æ˜¯ä¸ºéå†`å¯¹è±¡å±æ€§`è€Œæ„å»ºçš„ï¼Œ`ä¸å»ºè®®ä¸æ•°ç»„ä¸€èµ·ä½¿ç”¨`ï¼Œæ•°ç»„å¯ä»¥ç”¨`Array.prototype.forEach()`å’Œ`for ... of`ï¼Œé‚£ä¹ˆfor ... inçš„åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢?

å®ƒæœ€å¸¸ç”¨çš„åœ°æ–¹åº”è¯¥æ˜¯ç”¨äºè°ƒè¯•ï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„å»`æ£€æŸ¥å¯¹è±¡å±æ€§`(é€šè¿‡è¾“å‡ºåˆ°æ§åˆ¶å°æˆ–å…¶ä»–æ–¹å¼ï¼‰. å°½ç®¡å¯¹äºå¤„ç†å­˜å‚¨æ•°æ®ï¼Œæ•°ç»„æ›´å®ç”¨äº›ï¼Œä½†æ˜¯ä½ åœ¨å¤„ç†æœ‰`key-value`æ•°æ®(æ¯”å¦‚å±æ€§ç”¨ä½œâ€œé”®â€ï¼‰ï¼Œéœ€è¦æ£€æŸ¥å…¶ä¸­çš„ä»»ä½•é”®æ˜¯å¦ä¸ºæŸå€¼çš„æƒ…å†µæ—¶ï¼Œè¿˜æ˜¯æ¨èç”¨`for ... in`. 



### è¡¥å……
 2024/3/1

å…¨å±€çš„ `structuredClone()` æ–¹æ³•ä½¿ç”¨ç»“æ„åŒ–å…‹éš†ç®—æ³•å°†ç»™å®šçš„å€¼è¿›è¡Œæ·±æ‹·è´. 

```js
structuredClone(value)

value
è¢«å…‹éš†çš„å¯¹è±¡. å¯ä»¥æ˜¯ä»»ä½•ç»“æ„åŒ–å…‹éš†æ”¯æŒçš„ç±»å‹. 

const calendarEvent = {
  title: "Builder.io Conf",
  date: new Date(123),
  attendees: ["Steve"]
}

// ğŸ˜
const copied = structuredClone(calendarEvent)

å…‹éš†æ— é™åµŒå¥— çš„ å¯¹è±¡ å’Œ æ•°ç»„
å…‹éš†å¾ªç¯å¼•ç”¨
å¯ä»¥å…‹éš†ä»¥ä¸‹ç±»å‹, such as Date, Set, Map, Error, RegExp, ArrayBuffer, Blob, File, ImageData, and many more

å±€é™æ€§:  Function & Dom nodes & å¯¹è±¡åŸå‹

class MyClass { 
  foo = 'bar' 
  myMethod() { /* ... */ }
}
const myClass = new MyClass()

const cloned = structuredClone(myClass)
// Becomes: { foo: 'bar' }

cloned instanceof myClass // false
```